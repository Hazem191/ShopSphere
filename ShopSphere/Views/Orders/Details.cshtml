@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@model ShopSphere.ViewModels.OrderDetailsVM
@{
    ViewData["Title"] = Localizer["تفاصيل الطلب"];
    var o = Model.Order;
    var isRTL = System.Globalization.CultureInfo.CurrentCulture.Name.StartsWith("ar");
}

<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-area="" asp-controller="Orders" asp-action="Index">@Localizer["طلباتي"]</a></li>
        <li class="breadcrumb-item active">@o.OrderNumber</li>
    </ol>
</nav>

<div class="row g-4 @(isRTL ? "flex-row-reverse" : "")">
    <div class="col-lg-8">
        <div class="card mb-4 shadow-sm border-0" style="border-radius:15px;">
            <div class="card-header fw-bold bg-white border-bottom-0 pt-4">
                <i class="fas fa-box me-2"></i> @Localizer["منتجات الطلب"]
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-4">@Localizer["المنتج"]</th>
                                <th class="text-center">@Localizer["السعر"]</th>
                                <th class="text-center">@Localizer["الكمية"]</th>
                                <th class="text-center pe-4">@Localizer["الإجمالي"]</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Items)
                            {
                                <tr>
                                    <td class="ps-4 fw-semibold">
                                        <i class="fas fa-box-open me-2 text-muted"></i>
                                        @(item.Product?.Name ?? $"Product #{item.ProductId}")
                                    </td>
                                    <td class="text-center">@item.UnitPrice.ToString("N2") @Localizer["ج.م"]</td>
                                    <td class="text-center">@item.Quantity</td>
                                    <td class="text-center pe-4 fw-bold text-primary">@item.LineTotal.ToString("N2") @Localizer["ج.م"]</td>
                                </tr>
                            }
                        </tbody>
                        <tfoot class="table-light">
                            <tr>
                                <td colspan="3" class="fw-bold text-end pe-4">@Localizer["الإجمالي"]:</td>
                                <td class="text-center fw-bold fs-5 text-primary pe-4">@o.TotalAmount.ToString("N2") @Localizer["ج.م"]</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <a asp-area="" asp-controller="Orders" asp-action="Index" class="btn btn-outline-secondary rounded-pill px-4">
            <i class="fas fa-@(isRTL ? "arrow-right" : "arrow-left") me-1"></i> @Localizer["جميع الطلبات"]
        </a>
    </div>
    <div class="col-lg-4">
        <div class="card mb-3 shadow-sm border-0" style="border-radius:15px;">
            <div class="card-body">
                <h6 class="fw-bold mb-3"><i class="fas fa-info-circle me-2"></i> @Localizer["معلومات الطلب"]</h6>
                <div class="mb-2"><span class="text-muted small">@Localizer["رقم الطلب"]:</span> <strong>@o.OrderNumber</strong></div>
                <div class="mb-2"><span class="text-muted small">@Localizer["تاريخ الطلب"]:</span> @o.CreatedAt.ToString("dd/MM/yyyy HH:mm")</div>
                <div class="mb-2">
                    <span class="text-muted small">@Localizer["الحالة"]:</span>
                    @{
                        var badgeClass = o.Status switch {
                            "Pending"   => "bg-warning text-dark",
                            "Confirmed" => "bg-info text-white",
                            "Shipped"   => "bg-primary text-white",
                            "Delivered" => "bg-success text-white",
                            "Cancelled" => "bg-danger text-white",
                            _           => "bg-secondary text-white"
                        };
                    }
                    <span class="badge @badgeClass rounded-pill px-3">@Localizer[o.Status]</span>
                </div>
            </div>
        </div>

        @if (Model.ShippingAddress != null)
        {
            <div class="card shadow-sm border-0" style="border-radius:15px;">
                <div class="card-body">
                    <h6 class="fw-bold mb-3"><i class="fas fa-map-marker-alt me-2"></i> @Localizer["عنوان الشحن"]</h6>
                    <p class="mb-1">@Model.ShippingAddress.City</p>
                    <p class="mb-1">@Model.ShippingAddress.Street</p>
                    <p class="mb-0">@Model.ShippingAddress.Building</p>
                </div>
            </div>
        }
    </div>
</div>
